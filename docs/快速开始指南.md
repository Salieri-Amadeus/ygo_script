# å¿«é€Ÿå¼€å§‹æŒ‡å—

æ¬¢è¿ä½¿ç”¨æ¸¸æˆè‡ªåŠ¨åŒ–ç³»ç»Ÿ v2.0ï¼æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿä¸Šæ‰‹æ–°çš„æ¨¡å—åŒ–æ¶æ„ã€‚

## ğŸ¯ 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

### ç¬¬1æ­¥ï¼šå®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### ç¬¬2æ­¥ï¼šéªŒè¯ç¯å¢ƒ
```bash
python main.py --validate-only
```

### ç¬¬3æ­¥ï¼šå¯åŠ¨æ¸¸æˆå¹¶è¿è¡Œ
```bash
# å¯åŠ¨æ‚¨çš„æ¸¸æˆï¼Œç¡®ä¿åœ¨ä¸»æ˜¾ç¤ºå™¨ä¸Šè¿è¡Œ
python main.py --stats
```

## ğŸ”§ åŸºæœ¬é…ç½®

### åˆ›å»ºé…ç½®æ–‡ä»¶
åˆ›å»º `config.json` æ–‡ä»¶æ¥è‡ªå®šä¹‰è®¾ç½®ï¼š

```json
{
  "vision": {
    "threshold": 0.8,
    "timeout": 10
  },
  "state_machine": {
    "max_stop_count": 3
  },
  "logging": {
    "log_level": "INFO"
  }
}
```

### ä½¿ç”¨é…ç½®æ–‡ä»¶
```bash
python main.py --config config.json
```

## ğŸ® äº¤äº’æ¨¡å¼ä½¿ç”¨

è¿›å…¥äº¤äº’æ¨¡å¼å¯ä»¥æ‰‹åŠ¨æ§åˆ¶ç³»ç»Ÿï¼š

```bash
python main.py --interactive
```

**å¯ç”¨å‘½ä»¤:**
- `start` - å¯åŠ¨çŠ¶æ€æœº
- `start start_menu` - ä»æŒ‡å®šçŠ¶æ€å¯åŠ¨
- `stop` - åœæ­¢çŠ¶æ€æœº
- `status` - æŸ¥çœ‹å½“å‰çŠ¶æ€
- `stats` - æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- `states` - åˆ—å‡ºæ‰€æœ‰çŠ¶æ€
- `quit` - é€€å‡º

## ğŸ› ï¸ è‡ªå®šä¹‰çŠ¶æ€

### æ–¹æ³•1: ä½¿ç”¨ImageBasedStateï¼ˆæ¨èï¼‰
```python
from state_machine import state_machine, ImageBasedState

# åˆ›å»ºåŸºäºå›¾åƒçš„çŠ¶æ€
my_state = ImageBasedState(
    name="my_custom_state",
    target_image="my_button.png",
    next_state="next_state",
    description="æˆ‘çš„è‡ªå®šä¹‰çŠ¶æ€"
)

# æ³¨å†ŒçŠ¶æ€
state_machine.register_state(my_state)
```

### æ–¹æ³•2: ç»§æ‰¿BaseState
```python
from state_machine import BaseState, state_machine
from vision import vision_system

class MyComplexState(BaseState):
    def __init__(self):
        super().__init__("my_complex_state", "å¤æ‚çš„è‡ªå®šä¹‰çŠ¶æ€")
    
    def execute(self):
        # æ‚¨çš„è‡ªå®šä¹‰é€»è¾‘
        if vision_system.find_and_click("button1.png"):
            return "success_state"
        else:
            return "failure_state"

# æ³¨å†ŒçŠ¶æ€
state_machine.register_state(MyComplexState())
```

### æ–¹æ³•3: ä½¿ç”¨è£…é¥°å™¨ï¼ˆå…¼å®¹åŸç‰ˆï¼‰
```python
from state_machine import state

@state("my_function_state")
def handle_my_state():
    # æ‚¨çš„é€»è¾‘
    return "next_state"
```

## ğŸ“Š æ—¥å¿—å’Œè°ƒè¯•

### æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
æ—¥å¿—æ–‡ä»¶è‡ªåŠ¨ä¿å­˜åœ¨ `logs/` ç›®å½•ä¸­ï¼š
```bash
tail -f logs/game_automation.log
```

### è®¾ç½®æ—¥å¿—çº§åˆ«
```bash
python main.py --log-level DEBUG    # è¯¦ç»†è°ƒè¯•ä¿¡æ¯
python main.py --log-level INFO     # å¸¸è§„ä¿¡æ¯
python main.py --log-level WARNING  # ä»…è­¦å‘Šå’Œé”™è¯¯
```

### åœ¨ä»£ç ä¸­ä½¿ç”¨æ—¥å¿—
```python
from logger import get_logger

logger = get_logger(__name__)
logger.info("è¿™æ˜¯ä¸€æ¡ä¿¡æ¯")
logger.warning("è¿™æ˜¯ä¸€æ¡è­¦å‘Š")
logger.error("è¿™æ˜¯ä¸€æ¡é”™è¯¯")
```

## ğŸ” å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šå›¾åƒè¯†åˆ«å¤±è´¥
```python
# è°ƒæ•´åŒ¹é…é˜ˆå€¼
from config import config
config.vision.threshold = 0.7  # é™ä½é˜ˆå€¼
config.vision.timeout = 15     # å¢åŠ è¶…æ—¶æ—¶é—´
```

### é—®é¢˜2ï¼šçŠ¶æ€æœºå¡ä½
```python
# è°ƒæ•´é‡å¤æ£€æµ‹å‚æ•°
config.state_machine.max_stop_count = 3
config.state_machine.break_count = 5
```

### é—®é¢˜3ï¼šç‚¹å‡»ä½ç½®ä¸å‡†ç¡®
```python
# ä½¿ç”¨ç‚¹å‡»åç§»
state = ImageBasedState(
    name="my_state",
    target_image="button.png",
    next_state="next_state",
    click_offset=(10, -5)  # å‘å³10åƒç´ ï¼Œå‘ä¸Š5åƒç´ 
)
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘å›¾åƒæ–‡ä»¶å¤§å°
- ä½¿ç”¨PNGæ ¼å¼
- è£å‰ªåˆ°æœ€å°å¿…è¦åŒºåŸŸ
- ä¿æŒåˆé€‚çš„åˆ†è¾¨ç‡

### 2. è°ƒæ•´æ£€æŸ¥é—´éš”
```python
config.vision.check_interval = 0.3  # å‡å°‘CPUä½¿ç”¨
```

### 3. ä½¿ç”¨åŒºåŸŸæœç´¢
```python
from vision import ImageMatcher

matcher = ImageMatcher()
result = matcher.find_image("button.png", region=(100, 100, 200, 200))
```

## ğŸš€ é«˜çº§ç”¨æ³•

### æ‰¹é‡å¤„ç†å¤šä¸ªå›¾åƒ
```python
from vision import vision_system

# ç­‰å¾…ä»»æ„ä¸€ä¸ªå›¾åƒå‡ºç°
found_image = vision_system.wait_for_any_image([
    "button1.png",
    "button2.png", 
    "button3.png"
])
```

### è‡ªå®šä¹‰é”™è¯¯æ¢å¤
```python
class MyState(BaseState):
    def on_error(self, error):
        self.logger.error(f"å‘ç”Ÿé”™è¯¯: {error}")
        # è‡ªå®šä¹‰æ¢å¤é€»è¾‘
        vision_system.keyboard.press_key("escape")
        time.sleep(2)
        return "safe_state"  # è¿”å›å®‰å…¨çŠ¶æ€
```

### çŠ¶æ€ç»Ÿè®¡åˆ†æ
```python
# è·å–è¯¦ç»†ç»Ÿè®¡
stats = state_machine.get_statistics()
print(f"æˆåŠŸç‡: {stats['success_rate']:.2%}")
print(f"æ€»æ‰§è¡Œæ—¶é—´: {stats['total_transitions']}")

# æ‰“å°è¯¦ç»†æŠ¥å‘Š
state_machine.print_statistics()
```

## ğŸ“š ä¸‹ä¸€æ­¥

- é˜…è¯» [APIæ–‡æ¡£](API.md) äº†è§£è¯¦ç»†æ¥å£
- æŸ¥çœ‹ [TODO.md](../TODO.md) äº†è§£æœªæ¥åŠŸèƒ½
- å‚ä¸é¡¹ç›®å¼€å‘å’Œæ”¹è¿›

## ğŸ’¡ æç¤º

- å§‹ç»ˆä½¿ç”¨ `python main.py --validate-only` éªŒè¯ç¯å¢ƒ
- å¼€å‘æ—¶ä½¿ç”¨ `--log-level DEBUG` è·å–è¯¦ç»†ä¿¡æ¯
- ä½¿ç”¨äº¤äº’æ¨¡å¼ `--interactive` è¿›è¡Œè°ƒè¯•
- å®šæœŸä¿å­˜å’Œå¤‡ä»½æ‚¨çš„é…ç½®æ–‡ä»¶
- å…³æ³¨æ§åˆ¶å°è¾“å‡ºå’Œæ—¥å¿—æ–‡ä»¶äº†è§£æ‰§è¡ŒçŠ¶æ€

ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼ğŸ‰